---
title: "Usage and migration"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Usage and migration}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(tidyr)
```

This guide serves two distinct-but-related purposes:

  * Recommend best practices to maintainers of external packages that depend on tidyr. This is inspired by a similar guide in the development version of ggplot2: [Using ggplot2 in packages](https://ggplot2.tidyverse.org/dev/articles/ggplot2-in-packages.html).
  * Describe migration patterns for the transition from tidyr v0.8.3 to v1.0.0. This is a more time-dependent topic, but is handled here because it has considerable overlap with the first point.

## Stuff handy during development of this document

Revdep effort for v0.8.3 --> v.1.0.0

  * NEWS: <https://github.com/tidyverse/tidyr/blob/master/NEWS.md>
  * issue: <https://github.com/tidyverse/tidyr/issues/692>
  * revdep folder: <https://github.com/tidyverse/tidyr/tree/master/revdep>
  * spreadsheet: <https://docs.google.com/spreadsheets/d/13XXN8sepsc0Ftl5nVz4YdJCONbD_k00HOZUxbPosThM/edit#gid=0>

*dump unplaced thoughts and todo's here*

## Satisfying joint constraints

We will consider whether the code:

  * Works with tidyr v1.0.0.
    - Implications for a package: your package won't start failing on CRAN and for users when tidyr updates.
  * Also works with tidyr v0.8.3.
    - Implications for a package: you can submit your update to CRAN now. Your users will enjoy some reasonable period of backward/forward compatibility w.r.t. their installed version of tidyr.
  * Does not cause NOTEs or WARNINGs in `R CMD check`.

## `nest()`

### `nest_()`

## `unnest()`

### `unnest_()`

## Automated checking against tidyr

Hopefully you've already adopted continuous integration for your package, in which `R CMD check` (which includes your own tests) is run on a regular basis, e.g. every time you pushes changes to your package's source on GitHub or similar. The tidyverse team currently relies most heavily on Travis-CI for this, so that will be our example. `usethis::use_travis()` can help you get started.

We recommend adding a build to your matrix that targets the devel version of tidyr:

  * Always? If your package is tightly coupled to tidyr, consider leaving this build in place all the time, so you know if changes in tidyr affect your package. Modifiers like `allow_failures` and `fast_finish` may be useful. Read more about the [Travis build matrix](https://docs.travis-ci.com/user/customizing-the-build/#build-matrix).
  * Right before a tidyr release? For everyone else, you could just add a tidyr-devel build during the period preceding a major tidyr release that has the potential for breaking changes.

Example of `.travis.yml` config that tests against R devel, release, and oldrel, assesses test coverage, and includes a build against devel tidyr:

``` yaml
# R for travis: see documentation at https://docs.travis-ci.com/user/languages/r

language: R
cache: packages

matrix:
  include:
  - r: devel
  - r: release
    after_success:
    - Rscript -e 'covr::codecov()'
  - r: release
    name: tidyr-devel
    before_script: Rscript -e "remotes::install_github('tidyverse/tidyr')"
  - r: oldrel
```
